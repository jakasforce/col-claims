<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <name>CS_Enviar_notificacion_asignacion_paso_de_atencion_capitalizadora</name>
        <label>Enviar notificación asignación paso de atención capitalizadora</label>
        <locationX>578</locationX>
        <locationY>1058</locationY>
        <actionName>CS_AsginacionPasosAtencion__c.CS_Interno_asignacion_flujo_secundario_Capitalizadora</actionName>
        <actionType>emailAlert</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>CS_Asignacion_paso_atencion.Id</elementReference>
            </value>
        </inputParameters>
        <nameSegment>CS_AsginacionPasosAtencion__c.CS_Interno_asignacion_flujo_secundario_Capitalizadora</nameSegment>
    </actionCalls>
    <actionCalls>
        <name>CS_Enviar_notificacion_asignacion_paso_de_atencion_RL</name>
        <label>Enviar notificación asignación paso de atención RL</label>
        <locationX>314</locationX>
        <locationY>1058</locationY>
        <actionName>CS_AsginacionPasosAtencion__c.CS_Interno_asignacion_flujo_secundario_RL</actionName>
        <actionType>emailAlert</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>CS_Asignacion_paso_atencion.Id</elementReference>
            </value>
        </inputParameters>
        <nameSegment>CS_AsginacionPasosAtencion__c.CS_Interno_asignacion_flujo_secundario_RL</nameSegment>
    </actionCalls>
    <actionCalls>
        <name>CS_Enviar_notificacion_asignacion_paso_de_atencion_SV</name>
        <label>Enviar notificación asignación paso de atención SV</label>
        <locationX>50</locationX>
        <locationY>1058</locationY>
        <actionName>CS_AsginacionPasosAtencion__c.CS_Interno_asignacion_flujo_secundario_SV</actionName>
        <actionType>emailAlert</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>CS_Asignacion_paso_atencion.Id</elementReference>
            </value>
        </inputParameters>
        <nameSegment>CS_AsginacionPasosAtencion__c.CS_Interno_asignacion_flujo_secundario_SV</nameSegment>
    </actionCalls>
    <actionCalls>
        <name>Enviar_notificacion_paso_atencion_SG</name>
        <label>Enviar notificación paso de atención SG</label>
        <locationX>842</locationX>
        <locationY>1058</locationY>
        <actionName>CS_AsginacionPasosAtencion__c.CS_Interno_asignacion_flujo_secundario_SG</actionName>
        <actionType>emailAlert</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>CS_Asignacion_paso_atencion.Id</elementReference>
            </value>
        </inputParameters>
        <nameSegment>CS_AsginacionPasosAtencion__c.CS_Interno_asignacion_flujo_secundario_SG</nameSegment>
    </actionCalls>
    <apiVersion>56.0</apiVersion>
    <assignments>
        <name>CS_Asignar_valores_miembro_de_equipo_de_caso_a_crear</name>
        <label>Asignar valores a miembro de equipo de caso a crear</label>
        <locationX>402</locationX>
        <locationY>566</locationY>
        <assignmentItems>
            <assignToReference>CS_Miembro_equipo_caso_a_crear.TeamRoleId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>CS_Obtener_rol_Gestor_con_permiso_de_modificacion.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>CS_Miembro_equipo_caso_a_crear.ParentId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>CS_Caso_Relacionado.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>CS_Miembro_equipo_caso_a_crear.MemberId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>CS_Asignacion_paso_atencion.CS_PersonaAsignada__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>CS_Crear_nuevo_miembro_de_equipo_de_casos</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>CS_Cual_es_la_entidad_relacionada_al_caso</name>
        <label>Cuál es la entidad relacionada al caso?</label>
        <locationX>578</locationX>
        <locationY>950</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>CS_Seguros_de_vida</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>CS_Caso_Relacionado.CS_Subtipo__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>2</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>CS_Enviar_notificacion_asignacion_paso_de_atencion_SV</targetReference>
            </connector>
            <label>Seguros de vida</label>
        </rules>
        <rules>
            <name>CS_Riesgos_laborales</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>CS_Caso_Relacionado.CS_Subtipo__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>1</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>CS_Enviar_notificacion_asignacion_paso_de_atencion_RL</targetReference>
            </connector>
            <label>Riesgos laborales</label>
        </rules>
        <rules>
            <name>CS_Capitalizadora</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>CS_Caso_Relacionado.CS_Subtipo__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>3</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>CS_Enviar_notificacion_asignacion_paso_de_atencion_capitalizadora</targetReference>
            </connector>
            <label>Capitalizadora</label>
        </rules>
        <rules>
            <name>CS_SegurosGenerales</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>CS_Caso_Relacionado.CS_Subtipo__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>4</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Enviar_notificacion_paso_atencion_SG</targetReference>
            </connector>
            <label>Seguros Generales</label>
        </rules>
    </decisions>
    <decisions>
        <name>CS_Existe_rol_de_equipo_de_caso_a_asignar</name>
        <label>Existe rol de equipo de caso a asignar?</label>
        <locationX>534</locationX>
        <locationY>458</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>CS_Si_existe_rol_equipo_de_caso</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>CS_Obtener_rol_Gestor_con_permiso_de_modificacion.Id</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>CS_Asignar_valores_miembro_de_equipo_de_caso_a_crear</targetReference>
            </connector>
            <label>Si existe rol equipo de caso</label>
        </rules>
    </decisions>
    <decisions>
        <name>CS_Persona_asignada_a_paso_de_atencion_es_miembro_del_equipo_de_caso</name>
        <label>Persona asignada a paso de atención es miembro del equipo de caso?</label>
        <locationX>578</locationX>
        <locationY>242</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>CS_Es_miembro_del_equipo_de_caso</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Obtener_miembro_del_equipo_de_caso.Id</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>CS_Cual_es_la_entidad_relacionada_al_caso</targetReference>
            </connector>
            <label>Es miembro del equipo de caso</label>
        </rules>
        <rules>
            <name>CS_No_es_miembro_del_equipo_de_caso</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Obtener_miembro_del_equipo_de_caso.Id</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>CS_Obtener_rol_Gestor_con_permiso_de_modificacion</targetReference>
            </connector>
            <label>No es miembro del equipo de caso</label>
        </rules>
    </decisions>
    <description>Este flujo adiciona al equipo de casos el usuario definido como persona asignada en un paso de atención adicional.
Se incluye la ruta para Seguros Generales.</description>
    <environments>Default</environments>
    <interviewLabel>Adicionar usuario a equipo de casos {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Adicionar usuario a equipo de casos</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <name>CS_Crear_nuevo_miembro_de_equipo_de_casos</name>
        <label>Crear nuevo miembro de equipo de casos</label>
        <locationX>402</locationX>
        <locationY>674</locationY>
        <connector>
            <targetReference>CS_Cual_es_la_entidad_relacionada_al_caso</targetReference>
        </connector>
        <inputReference>CS_Miembro_equipo_caso_a_crear</inputReference>
    </recordCreates>
    <recordLookups>
        <name>CS_Obtener_rol_Gestor_con_permiso_de_modificacion</name>
        <label>Obtener rol Gestor con permiso de modificación</label>
        <locationX>534</locationX>
        <locationY>350</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>CS_Existe_rol_de_equipo_de_caso_a_asignar</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Name</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Nombre_rol_asignar_nuevo_miembro_equipo_del_caso</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>CaseTeamRole</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <description>Obtiene el registro asociado como miembro del equipo del caso cuando el usuario asignado al paso de atención ya existe en el equipo del caso</description>
        <name>Obtener_miembro_del_equipo_de_caso</name>
        <label>Obtener miembro del equipo de caso</label>
        <locationX>578</locationX>
        <locationY>134</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>CS_Persona_asignada_a_paso_de_atencion_es_miembro_del_equipo_de_caso</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>ParentId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>CS_Asignacion_paso_atencion.CS_CasoRelacionado__c</elementReference>
            </value>
        </filters>
        <filters>
            <field>MemberId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>CS_Asignacion_paso_atencion.CS_PersonaAsignada__c</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>CaseTeamMember</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <runInMode>SystemModeWithoutSharing</runInMode>
    <start>
        <locationX>452</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Obtener_miembro_del_equipo_de_caso</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <variables>
        <description>Corresponde a la asignación de paso de atención de la cual se tomará el responsable para asignarlo como miembro del equipo de casos</description>
        <name>CS_Asignacion_paso_atencion</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <objectType>CS_AsginacionPasosAtencion__c</objectType>
    </variables>
    <variables>
        <description>Corresponde a la información del caso relacionado al paso de atención</description>
        <name>CS_Caso_Relacionado</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <objectType>Case</objectType>
    </variables>
    <variables>
        <name>CS_Miembro_equipo_caso_a_crear</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>CaseTeamMember</objectType>
    </variables>
    <variables>
        <name>Nombre_rol_asignar_nuevo_miembro_equipo_del_caso</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <value>
            <stringValue>Gestor con permiso de modificación</stringValue>
        </value>
    </variables>
</Flow>
